import { VersionedMessage, VersionedTransaction } from '@solana/web3.js'
import bs58 from 'bs58'


const txData = [
  {
    "point": {
      "eid": 30168,
      "address": "5vqBiG7nxNnoCst8mEVVS6ax7C1ypEEenPfcZ4kLgj9B"
    },
    "data": "0200050a3c1b094729102e0c095ee2417e5940ee4f1eab4763f6113fe75281ab74c62398d686ca6c5f329a8001280fc5746b81b4d7adbe81cd03aecb55686030d04386906ede4e58bba1e64fe46a59b2b82cf7671a5023088c185c6d728cabe573d7a0f981de75538adf85cb66a4123b876bfac8cc4161b64a97dd61d531b8481de64c53d1a924c79b4977b1e2b6947624c1a2010141a1a4085f14e497cd1bdb93c3c58b00000000000000000000000000000000000000000000000000000000000000004939035f8dd13d15a9386e28b6705519aa6f488791323466a3c0116a201e51aa5aad76da514b6e1dcf11037e904dac3d375f525c9fbafcb19507b78907d8c18bc15627c37a10f89f1c6fc7fedd83ebbdd82cbddd14df55674498ec9c1eae1b31d578e9a30dd675e5136de2053bfa788ca50b12e9126862581411f169ab67bad100f9effef2f052929c665c8638c109b3301b187507d8a33c74e92e59344d73e2050804010306052d4fbba8398b8c5d2f957500000000000000000000000000000004acaf8d2865c0714f79da09645c13fd2888977f080401030605194fbba8398b8c5d2f9575000002020000000003020000000003080401030605104fbba8398b8c5d2f9575000001010000070501090402054cccab10d6b6bf1bc44939035f8dd13d15a9386e28b6705519aa6f488791323466a3c0116a201e51aa9575000000000000000000000000000004acaf8d2865c0714f79da09645c13fd2888977f0804010306052d4fbba8398b8c5d2f957500000000000000000000000000000004acaf8d2865c0714f79da09645c13fd2888977f",
    "description": "Setting peer for eid 30101 (ETHEREUM_V2_MAINNET) to address 0x00000000000000000000000004acaf8d2865c0714f79da09645c13fd2888977f FSRTW4KPGifKL8yKcZ8mfoR9mKtAjwZiTHbHwgix8AQo FSRTW4KPGifKL8yKcZ8mfoR9mKtAjwZiTHbHwgix8AQo"
  },
  {
    "point": {
      "eid": 30168,
      "address": "76y77prsiCMvXMjuoZ5VRrhG5qYBrUMYTE5WgHqgjEn6"
    },
    "data": "0201080c3c1b094729102e0c095ee2417e5940ee4f1eab4763f6113fe75281ab74c62398d686ca6c5f329a8001280fc5746b81b4d7adbe81cd03aecb55686030d0438690bea1bdf27223db07de9b172a19cc4f623605077ee12c05140f0f93547d370237d5fb940ecb19accaab23cab0942f13c467b6965ea3195fbaebc35902c0db9d6c16b7830c3f8a44c810ca87de56e032889c358ec75d4732bf7361862658acb2af3bb66c6947983775eb253df3d1c9818c2f958899b64a23b05a51bc8ed358f6e95aad76da514b6e1dcf11037e904dac3d375f525c9fbafcb19507b78907d8c18b619e429a1de67854bd455ee6643f568d6236cde8e9442a3abf029f016faae63064addff32f7e70f064aaeb7199486126df6abfa7e1b33d41a4673fab178685348fbf07b658af67d1ecc4465d90bf3f279f66037dc225e34689b370848205871cd578e9a30dd675e5136de2053bfa788ca50b12e9126862581411f169ab67bad10bf62f9dfd2ec1d9535e24a2750bd73635978cb21285076184ab3e8ef8142d189d009bd07e7435bfd04b7e7b2418c121276a0dc12ba901402519b2ecc00ef88601060c010a050407040203090b0807586c9e9aafd46234424939035f8dd13d15a9386e28b6705519aa6f488791323466a3c0116a201e51aa9575000001000000240000001027000093c69e71c758b9a308dd542e1c7f6edbf4b2342a6b74a0ce955ea97675f85528",
    "description": "Setting config for ULN 7a4WjyR8VZ7yZz5XJAKm39BUGn5iT9CKcv2pmG9tdXVH to [\n\t{\n\t\t\"eid\": 30101,\n\t\t\"configType\": 1,\n\t\t\"config\": {\n\t\t\t\"maxMessageSize\": 10000,\n\t\t\t\"executor\": \"AwrbHeCyniXaQhiJZkLhgWdUCteeWSGaSN1sTfLiY7xK\"\n\t\t}\n\t}\n]"
  },
  {
    "point": {
      "eid": 30168,
      "address": "76y77prsiCMvXMjuoZ5VRrhG5qYBrUMYTE5WgHqgjEn6"
    },
    "data": "0201080c3c1b094729102e0c095ee2417e5940ee4f1eab4763f6113fe75281ab74c62398d686ca6c5f329a8001280fc5746b81b4d7adbe81cd03aecb55686030d0438690bea1bdf27223db07de9b172a19cc4f623605077ee12c05140f0f93547d370237d5fb940ecb19accaab23cab0942f13c467b6965ea3195fbaebc35902c0db9d6c16b7830c3f8a44c810ca87de56e032889c358ec75d4732bf7361862658acb2af3bb66c6947983775eb253df3d1c9818c2f958899b64a23b05a51bc8ed358f6e95aad76da514b6e1dcf11037e904dac3d375f525c9fbafcb19507b78907d8c18b619e429a1de67854bd455ee6643f568d6236cde8e9442a3abf029f016faae63064addff32f7e70f064aaeb7199486126df6abfa7e1b33d41a4673fab178685348fbf07b658af67d1ecc4465d90bf3f279f66037dc225e34689b370848205871cd578e9a30dd675e5136de2053bfa788ca50b12e9126862581411f169ab67bad10bf62f9dfd2ec1d9535e24a2750bd73635978cb21285076184ab3e8ef8142d18fef0ea467b1c5860ef92069d2b0b921691afa9821c77d525b757352dc250394701060c010a050407040203090b080787016c9e9aafd46234424939035f8dd13d15a9386e28b6705519aa6f488791323466a3c0116a201e51aa9575000003000000530000000f000000000000000200000200000033cdb9fb56d28a2f028cbb36c254a7d54c92f0419b53e44ddcc0a5c373f854f2f3ea64a20ecedc882c28a0ba115a3a338ce2bb0d746d123c5b4abbdbead761f200000000",
    "description": "Setting config for ULN 7a4WjyR8VZ7yZz5XJAKm39BUGn5iT9CKcv2pmG9tdXVH to [\n\t{\n\t\t\"eid\": 30101,\n\t\t\"configType\": 3,\n\t\t\"config\": {\n\t\t\t\"confirmations\": \"15\",\n\t\t\t\"optionalDVNThreshold\": 0,\n\t\t\t\"requiredDVNs\": [\n\t\t\t\t\"4VDjp6XQaxoZf5RGwiPU9NR1EXSZn2TP4ATMmiSzLfhb\",\n\t\t\t\t\"HR9NQKK1ynW9NzgdM37dU5CBtqRHTukmbMKS7qkwSkHX\"\n\t\t\t],\n\t\t\t\"optionalDVNs\": [],\n\t\t\t\"requiredDVNCount\": 2,\n\t\t\t\"optionalDVNCount\": 0\n\t\t}\n\t}\n]"
  },
  {
    "point": {
      "eid": 30168,
      "address": "5vqBiG7nxNnoCst8mEVVS6ax7C1ypEEenPfcZ4kLgj9B"
    },
    "data": "020003063c1b094729102e0c095ee2417e5940ee4f1eab4763f6113fe75281ab74c62398d686ca6c5f329a8001280fc5746b81b4d7adbe81cd03aecb55686030d043869081de75538adf85cb66a4123b876bfac8cc4161b64a97dd61d531b8481de64c5300000000000000000000000000000000000000000000000000000000000000004939035f8dd13d15a9386e28b6705519aa6f488791323466a3c0116a201e51aac15627c37a10f89f1c6fc7fedd83ebbdd82cbddd14df55674498ec9c1eae1b31341207d9d4de9164af623e9a8a21209c2f5b221869c93f28534c3ba6f76d76eb01050401020403414fbba8398b8c5d2f957500000216000000000301001101000000000000000000000000000138801600000000030100110100000000000000000000000000013880",
    "description": "Setting enforced options to [\n\t{\n\t\t\"eid\": 30101,\n\t\t\"option\": {\n\t\t\t\"msgType\": 1,\n\t\t\t\"options\": \"0x00030100110100000000000000000000000000013880\"\n\t\t}\n\t},\n\t{\n\t\t\"eid\": 30101,\n\t\t\"option\": {\n\t\t\t\"msgType\": 2,\n\t\t\t\"options\": \"0x00030100110100000000000000000000000000013880\"\n\t\t}\n\t}\n]"
  }
]

const transactionDataHex = '80010004063c1b094729102e0c095ee2417e5940ee4f1eab4763f6113fe75281ab74c62398a8360ae4dd83a509ca02a80763c269baf6769357792fd04e3f188b72c1baeb6c0b7065b1e3d17c45389d527f6b04c3cd58b86c731aa0fdb549b6d1bc03f829460ebef59dac440497ad2b91328e6ee05369dbee1d6d1fb8f34fad284d0bb20a5b000000000000000000000000000000000000000000000000000000000000000006a7d517187bd16635dad40455fdc2c0c124c68f215675a5dbbacb5f08000000b980771914cfe8acd1731638f9f9c5e89e39961032b75146831335977ed8d34d01020b0002020301020004050202d40132000001040000004672617804000000465241588c00000068747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f4672617846696e616e63652f667261782d6f66742d7570677261646561626c652f333765616565623935653263373438356637383162333934313865353762366136346434386438362f736f6c616e612d6d61696e6e65742d6d657461646174612f6678732e6a736f6e000001010000003c1b094729102e0c095ee2417e5940ee4f1eab4763f6113fe75281ab74c6239801640000000000000000'
const versionedMessage = VersionedMessage.deserialize(Buffer.from(transactionDataHex, 'hex'))
const path = "./scripts/ops/fix/FixDVNs/txs"
const outputFilename = "2d-upgradeDVNSolana-wfrax-252.txt"

txData.forEach(_tx => {
  const tx = new VersionedTransaction(VersionedMessage.deserialize(Buffer.from(_tx.data, 'hex')));
  console.log(_tx.description)
  console.log(bs58.encode(Buffer.from(tx.serialize())))
  const unixTimestamp = Math.floor(Date.now() / 1000);
  const base58Tx = bs58.encode(Buffer.from(tx.serialize()));
  fs.writeFileSync(`${path}/${unixTimestamp}-${outputFilename}`, base58Tx, 'utf8');
});